#/bin/bash
    FQDN=$1
    echo "rewriting /etc/hosts"
    if [ -f /etc/.new_etc_hosts ];then rm /etc/.new_etc_hosts;fi
    HNAME=$(echo ${FQDN} |sed -e 's/\..*//g')
    LOCAL=$(grep "127.0.0.1" /etc/hosts| head -1)
    if [ ! -z "${LOCAL}" ];then 
        echo "${LOCAL}"|grep -q "127.0.0.1 *localhost.localdomain *localhost" || \
          LOCAL=$(echo ${LOCAL}|sed -e 's/127.0.0.1.*/127.0.0.1 localhost.localdomain localhost/')
    else
        LOCAL="127.0.0.1 localhost.localdomain localhost" 
    fi
    PUBLIC=$(grep "${IPADDR}" /etc/hosts)
    if [ ! -z "${PUBLIC}" ];then 
        echo "${PUBLIC}"|grep -q "${IPADDR} *${FQDN} *${HNAME}"||\
            PUBLIC=$(echo "${PUBLIC}"| sed -e "s/${IPADDR}.*/${IPADDR} ${FQDN} ${HNAME}/")
    else
        PUBLIC="${IPADDR} ${FQDN} ${HNAME}"
    fi
    echo "${LOCAL}" > /etc/.new_etc_hosts
    echo "${PUBLIC}" >> /etc/.new_etc_hosts
    sed -e "s/127.0.0.1.*//" -e "s/${IPADDR}.*//" /etc/hosts |grep .>> /etc/.new_etc_hosts
    if [ ! -f /etc/hosts.dists ];then mv /etc/hosts /etc/hosts.dist;fi
    mv /etc/.new_etc_hosts /etc/hosts
